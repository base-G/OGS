<!DOCTYPE html>
<html>
	<head>
		<title>OGS Test</title>
		
		<link rel="stylesheet" href="css/style.css"></link>

		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="js/pdf.js/src/core.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/util.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/api.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/canvas.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/obj.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/function.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/charsets.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/cidmaps.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/colorspace.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/crypto.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/evaluator.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/fonts.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/glyphlist.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/image.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/metrics.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/parser.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/pattern.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/stream.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/worker.js"></script>
  		<script type="text/javascript" src="js/pdf.js/external/jpgjs/jpg.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/jpx.js"></script>
  		<script type="text/javascript" src="js/pdf.js/src/jbig2.js"></script>

  		<script type="text/javascript">
    			PDFJS.workerSrc = 'js/pdf.js/src/worker_loader.js';
  		</script>
	</head>

	<body>
        <div id="menu">
            <button id="prev" onclick="goPrevious()">&lt&lt</button>
            <button id="next" onclick="goNext()">&gt&gt</button>
            <button id="next" onclick="decrease()">-</button>
            <button id="next" onclick="increase()">+</button>&nbsp; &nbsp; <span>Page: <span id="page_num"></span> / <span id="page_count"></span></span>
        </div>
        <div>
            <canvas id="the-canvas" style="border:1px solid black"></canvas>
        </div>
        <!-- Use latest PDF.js build from Github -->
        <script type="text/javascript">
            var url = 'ProjectArtifacts/ProjectDeliverable.pdf';
            PDFJS.disableWorker = true;

            var pdfDoc = null,
                pageNum = 1,
                scale = 1.0,
                canvas = document.getElementById('the-canvas'),
                ctx = canvas.getContext('2d');

            // Get page info from document, resize canvas accordingly, and render page
            function renderPage(num) {
                // Using promise to fetch the page
                pdfDoc.getPage(num).then(function(page) {
                    var viewport = page.getViewport(scale);
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    // Render PDF page into canvas context
                    var renderContext = {
                        canvasContext: ctx,
                        viewport: viewport
                    };
                    page.render(renderContext);
                });

                // Update page counters
                document.getElementById('page_num').textContent = pageNum;
                document.getElementById('page_count').textContent = pdfDoc.numPages;
            }

            //
            // Go to previous page
            //
            function goPrevious() {
                if (pageNum <= 1) return;
                pageNum--;
                renderPage(pageNum);
            }

            //
            // Go to next page
            //
            function goNext() {
                if (pageNum >= pdfDoc.numPages) return;
                pageNum++;
                renderPage(pageNum);
            }

            function increase() {
                scale += 0.1;
                renderPage(pageNum);
                redraw(2);
            }

            function decrease() {
                scale -= 0.1;
                renderPage(pageNum);
            }

            //
            // Asynchronously download PDF as an ArrayBuffer
            //
            PDFJS.getDocument(url).then(function getPdfHelloWorld(_pdfDoc) {
                pdfDoc = _pdfDoc;
                renderPage(pageNum);
            });
            
            $('#the-canvas').mousedown(function (e) {
    var mouseX = e.pageX - this.offsetLeft;
    var mouseY = e.pageY - this.offsetTop;

    paint = true;
    addClick(e.pageX - this.offsetLeft, e.pageY - this.offsetTop);
    redraw();
});

$('#the-canvas').mousemove(function (e) {
    if (paint) {
        addClick(e.pageX - this.offsetLeft, e.pageY - this.offsetTop, true);
        redraw();
    }
});

$('#the-canvas').mouseup(function (e) {
    paint = false;
});

$('#the-canvas').mouseleave(function (e) {
    paint = false;
});

// Store X, Y, and drag poisitions in an array.
var clickX = new Array();
var clickY = new Array();
var clickDrag = new Array();
var paint;

// Adds the click into the corresponding arrays.
function addClick(x, y, dragging) {
    clickX.push(x);
    clickY.push(y);
    clickDrag.push(dragging);
}

// Draws the canvas.
function redraw() {
    // Clears the canvas
    //canvas.width = canvas.width; 
    ctx.strokeStyle = "#000000";
    ctx.lineJoin = "bevel";
    ctx.lineWidth = 2;

    for (var i = 0; i < clickX.length; i++) {
        ctx.beginPath();

        if (clickDrag[i] && i) {
            ctx.moveTo(clickX[i - 1], clickY[i - 1]);
        } else {
            ctx.moveTo(clickX[i] - 1, clickY[i]);
        }

        ctx.lineTo(clickX[i], clickY[i]);
        ctx.closePath();
        ctx.stroke();
    }
}

        </script>
    </body>
</html>
